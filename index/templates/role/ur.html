{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户信息</title>
        <!-- 引入 Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- 引入 Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
.image-container {
    position: relative;
    display: flex;
    justify-content: center; /* 水平居中 */
    align-items: center; /* 垂直居中 */
    margin-bottom: 20px; /* 添加一些底部间距 */
}

   body {
            font-family: Arial, sans-serif;
            background-image: url({% static 'img/bk2.png' %});
            background-size: cover; /* 让背景图片充满整个屏幕 */
            background-repeat: no-repeat; /* 防止背景图片重复 */
        }

        .image-container {
    position: relative;
    display: inline-block;
}

.image-upload-label {
    display: block;
    position: relative;
    cursor: pointer;
}

.image-upload-label img {
    max-width: 50%;
    height: auto;
    border-radius: 50%;
    margin-bottom: 10px;
}

.image-upload-label span {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.7);
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
    display: none;
}

.image-upload-label:hover span {
    display: block;
}

/* 隐藏 input[type="file"] */
input[type="file"] {
    display: none;
}
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .info-item {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
        }

        input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            pointer-events: none; /* 默认状态下禁止点击 */
        }
        select#education {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            pointer-events: none; /* 默认状态下禁止点击 */
            appearance: none; /* 去除默认样式 */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); /* 使用自定义下拉箭头 */
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        img {
            max-width: 50%;
            height: auto;
            border-radius: 50%;
            margin-bottom: 10px;
        }

        .edit-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .save-button {
            background-color: #28a745;
        }

        .cancel-button {
            background-color: #dc3545;
        }
        .resume-textarea {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: vertical; /* 允许垂直拖动调整大小 */
        }

        /* 添加样式用于装饰 */
        .decoration {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 20px;
        }
        .centered-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        .centered-form h2 {
            margin-top: 0;
            text-align: center;
            color: #333;
        }

        .centered-form label {
            display: block;
            margin-bottom: 10px;
        }

        .centered-form input[type="password"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .centered-form .edit-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .centered-form .edit-button.cancel-button {
            background-color: #dc3545;
        }

        .centered-form .edit-button.confirm-button {
            background-color: #28a745;
        }
.logout-button {
    background-color: #dc3545;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    position: absolute;
    top: 60px;
    right: 360px;
}
.custom-select {
    /* 你可以根据需要添加更多的样式 */
    width: 200px; /* 设置下拉框的宽度 */
    padding: 5px; /* 内边距 */
    font-size: 16px; /* 字体大小 */
    border: 1px solid #ccc; /* 边框 */
    border-radius: 4px; /* 边框圆角 */
    /* 为了更好地适配移动设备，可以添加touch样式 */
    -webkit-appearance: none; /* 移除iOS的内置样式 */
    -moz-appearance: none; /* 移除Firefox的内置样式 */
    appearance: none; /* 移除其他浏览器的内置样式 */
    background-color: #fff; /* 背景颜色 */
}
    </style>
    <script>
    var csrfToken = "{{ csrf_token }}";
</script>

</head>
<body>
    <div class="container">
{#        <h1>用户信息</h1>#}
{#                    <button class="logout-button" onclick="logout()">退出登录</button>#}
        <div class="container1">
    <div class="header-row">
        <h1 class="user-info-title">用户信息</h1>
        <button class="logout-button" onclick="logout()">退出登录</button>
    </div>
    <!-- 其余部分保持不变 -->
</div>
        <div class="image-container">
    <label for="file-upload" class="image-upload-label">
        <img class="resized-image" src="data:image/png;base64,{{ image_data }}" alt="Resi   zed Image">
        <span>点击上传照片</span>
    </label>
    <input type="file" id="file-upload" style="display: none;">
</div>
        <div class="info-item">
            <label for="user-id">用户号:</label>
            <input type="text" id="user-id" readonly>
        </div>
        <div class="info-item">
            <label for="phone">手机号码:</label>
            <input type="text" id="phone" readonly>
        </div>
        <div class="info-item">
            <label for="location">住址:</label>
            <input type="text" id="location" readonly>
        </div>
        <div class="info-item">
    <label for="education">最高学历:</label>
    <select id="education">
        <option value="junior">初中</option>
        <option value="highschool">高中</option>
        <option value="secondary">中专</option>
        <option value="associate">大专</option>
        <option value="bachelor" >本科</option>
        <option value="master">硕士</option>
        <option value="doctorate">博士</option>
        <option value="none">无</option>
    </select>
</div>
        <div class="info-item">
            <label for="experience">工作经验:</label>
            <input type="text" id="experience" readonly>
        </div>
        <div class="info-item">
            <label for="age">年龄:</label>
            <input type="text" id="age" readonly>
        </div>
        <div class="info-item">
            <label for="name">姓名:</label>
            <input type="text" id="name" readonly>
        </div>
        <div class="info-item">
            <label for="gender">性别:</label>
            <input type="text" id="gender" readonly>
        </div>
        {% csrf_token %}
        <br>
        <button class="edit-button" onclick="enableEditing()">编辑信息</button>
          <button class="edit-button" onclick="editResume()">编辑简历</button>
        <button class="edit-button" onclick="showChangePassword()">修改密码</button>
        <!-- 寻找工作按钮 -->
        <button class="edit-button" onclick="redirectToJobs()">寻找工作</button>
        <button class="edit-button" onclick="result()">选择结果</button>
        <button class="edit-button save-button" onclick="saveChanges()" style="display: none;">保存</button>
        <button class="edit-button cancel-button" onclick="cancelChanges()" style="display: none;">取消</button>
        <div id="resume-editor" class="resume_ed" style="display: none;">
    <div class="resume-item">
        <label for="resume-1">介绍:</label>
        <textarea class="resume-textarea" id="resume-1" placeholder="简历1"></textarea>
    </div>
    <div class="resume-item">
        <label for="resume-2">优势:</label>
        <textarea class="resume-textarea" id="resume-2" placeholder="简历2"></textarea>
    </div>
    <div class="resume-item">
        <label for="resume-3">期望:</label>
        <textarea class="resume-textarea" id="resume-3" placeholder="简历3"></textarea>
    </div>
            <div class="education-table">
        <h2>教育经历</h2>
        <table id="education-table">
            <thead>
                <tr>
                    <th>      </th>
                    <th>学校</th>
                    <th>学校类型</th>
                    <th>学位</th>
                    <th>专业</th>
                    <th>毕业年份</th>
                    <th>      </th>

                </tr>
            </thead>
            <tbody id="education-table-body">
                <!-- 这里将用JavaScript来填充表格 -->
            </tbody>
        </table>
                <button class="edit-button save-button" onclick="addEducation()">添加教育经历</button>
    </div>
    <button class="edit-button save-button" onclick="saveResume()">保存简历</button>
    <!-- 返回按钮 -->
    <button class="edit-button cancel-button" onclick="goBack()">返回</button>

</div>

        </div>
         <div id="change-password" class="centered-form" style="display: none;">
            <span onclick="cancelChangePassword()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">×</span>
            <h2>修改密码</h2>
            <div>
                <label for="current-password">当前密码:</label>
                <input type="password" id="current-password">
            </div>
            <div>
                <label for="new-password">新密码:</label>
                <input type="password" id="new-password">
            </div>
            <div>
                <label for="confirm-password">确认密码:</label>
                <input type="password" id="confirm-password">
            </div>
            <button class="edit-button confirm-button" onclick="changePassword()">确认修改</button>
            <button class="edit-button cancel-button" onclick="cancelChangePassword()">取消</button>
        </div>
        <div id="education-dialog" class="centered-form" style="display: none;">
    <span onclick="cancelAddEducation()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">×</span>
    <h2>添加教育经历</h2>
    <div>
        <label for="school-input">学校名称:</label>
        <input type="text" id="school-input" list="options">

        <datalist id="options">
            {% for sch in school %}
                <option value="{{ sch.schoolname }}">
            {% endfor %}
          <!-- 其他选项 -->
        </datalist>


    </div>
    <div>
        <label for="degree-select">学位:</label>
        <select id="degree-select" class="custom-select">
            <option value="本科">本科</option>
            <option value="硕士">硕士</option>
            <option value="博士">博士</option>
        </select>
    </div>
    <div>
        <label for="major-input">专业:</label>
        <input type="text" id="major-input">
    </div>
    <div>
        <label for="graduation-year-input">毕业年份:</label>
        <input type="text" id="graduation-year-input">
    </div>
    <button class="edit-button confirm-button" onclick="submitEducation()">提交</button>
    <button class="edit-button cancel-button" onclick="cancelAddEducation()">取消</button>
</div>

        <!-- 装饰 -->
        <div class="decoration"></div>
    </div>

    <script>
    var schoolList=[]
    {% for sch in school %}
        schoolList.push({schoolid:'{{ sch.schoolid }}',schoolLogo: '{{ sch.schoolLogo }}',schoolname:'{{ sch.schoolname }}',type:'{{ sch.schooltype }}'})
    {% endfor %}
        let blank=document.getElementById('user-id')
        blank.value='{{ userid }}'
        blank=document.getElementById('phone')
        blank.value='{{ telephone }}'
        blank=document.getElementById('location')
        blank.value='{{ Raddress }}'
        blank=document.getElementById('experience')
        blank.value='{{ experience }}'
        blank=document.getElementById('age')
        blank.value='{{ age }}'
        blank=document.getElementById('name')
        blank.value='{{ name }}'
        blank=document.getElementById('gender')
        blank.value='{{ sex }}'
        blank=document.getElementById('education')


switch ('{{ highestEdu }}') {

  case "高中":
    blank.value = 'highschool';
    break;
  case "初中":
    blank.value = 'junior';
    break;

  case "中专":
    blank.value = 'secondary';
    break;
  case "大专":
    blank.value = 'associate';
    break;
  case "本科":
    blank.value = 'bachelor';
    break;
  case "硕士":
    blank.value = 'master';
    break;
  case "博士":
    blank.value = 'doctorate';
    break;
  case "无":
    blank.value = 'none';
    break;
  default:
    console.log("未知教育水平");
}



        function enableEditing() {
    // 将所有输入框的 pointer-events 属性设为 auto，使其可点击
            var inputs = document.querySelectorAll('input[type="text"]');
            for (var i = 1; i < inputs.length; i++) {
                inputs[i].removeAttribute('readonly');
                inputs[i].style.pointerEvents = 'auto';
            }

            // 将学历选择框的 pointer-events 属性设为 auto，使其可点击
            document.getElementById('education').style.pointerEvents = 'auto';

            // 隐藏编辑按钮，显示保存和取消按钮
            document.querySelector('.edit-button').style.display = 'none';
            document.querySelector('.save-button').style.display = 'inline-block';
            document.querySelector('.cancel-button').style.display = 'inline-block';
        }


        function saveChanges() {
    // 收集用户信息
    var userId = document.getElementById('user-id').value;
    var phone = document.getElementById('phone').value;
    var location = document.getElementById('location').value;
    var experience = document.getElementById('experience').value;
    var age = document.getElementById('age').value;
    var name = document.getElementById('name').value;
    var gender = document.getElementById('gender').value;
    var education = document.getElementById('education');
    education=education[education.selectedIndex].text
    console.log(userId,phone,location,experience,age,name,gender,education)
    // 构造要发送的数据对象
    var data = {
        label:'data',
        userId: userId,
        phone: phone,
        location: location,
        experience: experience,
        age: age,
        name: name,
        gender: gender,
        education: education
    };
    var currentUrl = window.location.href;
    // 发送POST请求到后端
    fetch(currentUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // 解析JSON响应
        return response.json();
    })
    .then(data => {
        // 处理后端返回的JSON数据
        if (data.hasOwnProperty('error')) {
            window.location.reload();
            // 如果后端返回了错误消息，说明操作失败
            alert('信息更新错误:', data.error);
            // 在这里可以将前端更改的信息恢复，例如重新加载页面

        } else {
            // 否则，操作成功
            alert('信息更新成功');
            // 这里你可以根据实际情况进行页面重定向或其他操作
            cancelChanges();
        }
    })
    .catch(error => {
        console.error('There was a problem with your fetch operation:', error);
        // 这里可以根据实际情况处理错误
    });
}

        function cancelChanges() {
            // 将所有输入框的 pointer-events 属性设为 none，使其不可点击
            var inputs = document.querySelectorAll('input[type="text"]');
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].setAttribute('readonly', 'readonly');
                inputs[i].style.pointerEvents = 'none';
            }

            // 隐藏保存和取消按钮，显示编辑按钮
            document.querySelector('.edit-button').style.display = 'inline-block';
            document.querySelector('.save-button').style.display = 'none';
            document.querySelector('.cancel-button').style.display = 'none';
        }
        function editResume() {
    // 隐藏其他信息
    var infoItems = document.querySelectorAll('.info-item');
    for (var i = 0; i < infoItems.length; i++) {
        infoItems[i].style.display = 'none';
    }

    // 隐藏编辑按钮
    document.querySelector('.edit-button').style.display = 'none';

    // 显示简历编辑框
    document.getElementById('resume-editor').style.display = 'block';

    // 加载简历内容
    var resume1 = document.getElementById('resume-1')
    var resume2 = document.getElementById('resume-2')
    var resume3 = document.getElementById('resume-3')
    var resume = [resume1, resume2, resume3]
    var reslst = []
    {% for res in resume %}
        reslst.push('{{ res }}')
    {% endfor %}
    for (let i = 0; i < {{ lengths }}; i++) {
        resume[i].value = reslst[i]
    }
    getEducationData();
}


        function saveResume() {
    // 获取简历内容
    let resume1 = document.getElementById('resume-1').value;
    let resume2 = document.getElementById('resume-2').value;
    let resume3 = document.getElementById('resume-3').value;

    // 构造要发送的数据对象
    var data = {
        label:'resume',
        resume1: resume1,
        resume2: resume2,
        resume3: resume3
    };

    // 发送POST请求到后端
    fetch('', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken // 根据你的页面中实际的CSRF Token变量名填写
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // 解析JSON响应
        return response.json();
    })
    .then(data => {
        // 处理后端返回的JSON数据
        if (data.hasOwnProperty('error')) {
            // 如果后端返回了错误消息，说明保存失败
            alert('保存简历失败: ' + data.error);
        } else {
            // 否则，保存成功
            alert('简历保存成功！');
        }
    })
    .catch(error => {
        console.error('There was a problem with your fetch operation:', error);
        // 这里可以根据实际情况处理错误
    });
}

        function goBack() {
    // 返回到显示用户信息的页面
    window.location.href = ''; // 替换 '/user_info_url' 为你的用户信息页面的 URL
}
 function showChangePassword() {
            document.getElementById('change-password').style.display = 'block';
        }

        function cancelChangePassword() {
            document.getElementById('change-password').style.display = 'none';
        }

        function changePassword() {
            var currentPassword = document.getElementById('current-password').value;
            var newPassword = document.getElementById('new-password').value;
            var confirmPassword = document.getElementById('confirm-password').value;

            // 检查密码是否为空
            if (currentPassword === '' || newPassword === '' || confirmPassword === '') {
                alert('密码不能为空');
                return;
            }

            // 检查新密码和确认密码是否一致
            if (newPassword !== confirmPassword) {
                alert('新密码和确认密码不一致');
                return;
            }

            // 构造要发送的数据对象
            var data = {
                label:'changePassword',
                currentPassword: currentPassword,
                newPassword: newPassword
            };

            // 发送POST请求到后端
            fetch('', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // 解析JSON响应
                return response.json();
            })
            .then(data => {
                // 处理后端返回的JSON数据
                if (data.hasOwnProperty('error')) {
                    // 如果后端返回了错误消息，说明保存失败
                    alert('修改密码失败: ' + data.error);
                } else {
                    // 否则，保存成功
                    alert('密码修改成功！');
                    // 清空输入框
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                    document.getElementById('confirm-password').value = '';
                    // 隐藏修改密码页面
                    cancelChangePassword();
                }
            })
            .catch(error => {
                console.error('There was a problem with your fetch operation:', error);
                // 这里可以根据实际情况处理错误
            });
        }
        function redirectToJobs() {
    // 跳转到寻找工作页面
    window.location.href = '/jobs/';
}

document.getElementById('file-upload').addEventListener('change', function(event) {
    var file = event.target.files[0];
    var reader = new FileReader();

    reader.onload = function(e) {
        var imageSrc = e.target.result;
        document.querySelector('.resized-image').src = imageSrc;

        // 将图片转换为 Base64 编码
        var base64Image = imageSrc.split(',')[1]; // 去掉 data:image/jpeg;base64, 前缀

        // 发送 Base64 编码的图片数据给后端
        sendBase64ImageToBackend(base64Image);
    };

    reader.readAsDataURL(file);
});

function sendBase64ImageToBackend(base64Image) {
    // 构造要发送的数据对象
    var data = {
        label:'photo',
        image_data: base64Image
    };

    // 发送 AJAX 请求到后端
    fetch('', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken // 根据实际情况填写CSRF Token
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // 解析 JSON 响应
        return response.json();
    })
    .then(data => {
        // 处理后端返回的 JSON 数据
        console.log('Image uploaded successfully:', data);
    })
    .catch(error => {
        console.error('There was a problem with your fetch operation:', error);
        // 这里可以根据实际情况处理错误
    });
}


// 假设 getEducationData() 函数从后端获取教育经历数据，并以数组的形式返回
function getEducationData() {
    // 这里假设 educationData 是从后端获取的教育经历数据，格式为 [{}, {}, ...]
    // 每个对象包含学校校徽、学校、学位、专业和毕业年份等信息
    var educationData=[]
    if({{ lengths_of_education_experience }}==0){
    return;
    }

{#schoolname,schoolLogo,schooltype,degree,major,finashdate#}
    {% for edu in education_experience %}
        educationData.push({schoolLogo:'{{ edu.schoolLogo }}',school:'{{ edu.schoolname }}',schooltype:'{{ edu.schooltype }}',degree:'{{ edu.degree }}',major:'{{ edu.major }}',graduationYear:'{{ edu.finishdate }}'})
        console.log('{{ edu.finishdate }}')
    {% endfor %}

    // 获取表格的 tbody 元素
    var educationTableBody = document.getElementById('education-table-body');

    // 清空表格内容
    educationTableBody.innerHTML = '';

    // 循环遍历教育经历数据，为表格添加行和单元格
    educationData.forEach(function(education) {
        var row = document.createElement('tr');

        // 创建并填充单元格
        var schoolLogoCell = document.createElement('td');
        var schoolLogoImg = document.createElement('img');
        schoolLogoImg.alt = "Binary Image";
        schoolLogoImg.src = 'data:image/png;base64,' + education.schoolLogo;
        schoolLogoCell.appendChild(schoolLogoImg);
        row.appendChild(schoolLogoCell);

        var schoolCell = document.createElement('td');
        schoolCell.textContent = education.school;
        row.appendChild(schoolCell);

        var schoolType = document.createElement('td');
        schoolType.textContent = education.schooltype;
        row.appendChild(schoolType);

        var degreeCell = document.createElement('td');
        degreeCell.textContent = education.degree;
        row.appendChild(degreeCell);

        var majorCell = document.createElement('td');
        majorCell.textContent = education.major;
        row.appendChild(majorCell);

        var graduationYearCell = document.createElement('td');
        graduationYearCell.textContent = education.graduationYear;
        row.appendChild(graduationYearCell);

        var del = document.createElement('button');
        del.className="edit-button cancel-button"
        del.textContent = '删除';
        del.onclick = function() {
            removeEducation(row);
        };
        var delButtonCell = document.createElement('td');
        delButtonCell.appendChild(del);
        row.appendChild(delButtonCell);

        // 将行添加到表格中
        educationTableBody.appendChild(row);
    });
}

function addEducation() {
    document.getElementById('education-dialog').style.display = 'block';
    {#enableEditing1()#}
    var inputs = document.querySelectorAll('input[type="text"]');
    for (var i = 0; i < inputs.length; i++) {
        inputs[i].removeAttribute('readonly');
        inputs[i].style.pointerEvents = 'auto';
    }

    // 将学历选择框的 pointer-events 属性设为 auto，使其可点击
    document.getElementById('education').style.pointerEvents = 'auto';

    // 隐藏编辑按钮，显示保存和取消按钮
    document.querySelector('.edit-button').style.display = 'none';
}

function enableEditing1() {
    // 将所有输入框的 pointer-events 属性设为 auto，使其可点击
    var inputs = document.querySelectorAll('input[type="text"]');
    for (var i = 0; i < inputs.length; i++) {
        inputs[i].removeAttribute('readonly');
        inputs[i].style.pointerEvents = 'auto';
    }

    // 将学历选择框的 pointer-events 属性设为 auto，使其可点击
    document.getElementById('education').style.pointerEvents = 'auto';

    // 隐藏编辑按钮，显示保存和取消按钮
    document.querySelector('.edit-button').style.display = 'none';
    document.querySelector('.save-button').style.display = 'inline-block';
    document.querySelector('.cancel-button').style.display = 'inline-block';
}

function submitEducation() {


    var school = document.getElementById('school-input').value;

    var degree = document.getElementById('degree-select').value;
    var major = document.getElementById('major-input').value;
    var graduationYear = document.getElementById('graduation-year-input').value;

    for(let i=0;i<schoolList.length;i++){
        if(schoolList[i].schoolname.trim()==String(school).trim()){
            var schoolLogo=schoolList[i].schoolLogo
            var schoolType = schoolList[i].type
            var schoolid=schoolList[i].schoolid
        }
    }

    if (school &&  degree && major && graduationYear) {
        // 插入到表格中
        var tableBody = document.getElementById('education-table-body');
        var newRow = document.createElement('tr');

        newRow.innerHTML = `
            <td><img src="data:image/png;base64,${schoolLogo}" alt="学校校徽"></td>
            <td>${school}</td>
            <td>${schoolType}</td>
            <td>${degree}</td>
            <td>${major}</td>
            <td>${graduationYear}</td>
            <td><button class="edit-button cancel-button" onclick="removeEducation(this)">删除</button></td>
        `;
        tableBody.appendChild(newRow);
        saveEdu(schoolid,degree,major,graduationYear);
        document.getElementById('school-input').value = '';
        document.getElementById('degree-select').value = '本科';
        document.getElementById('major-input').value = '';
        document.getElementById('graduation-year-input').value = '';

        // 隐藏对话框
        document.getElementById('education-dialog').style.display = 'none';
    } else {
        alert("请填写完整的教育经历信息！");
    }
}
function saveEdu(schoolid,degree,major,graduationYear) {
    // 构造要发送的数据对象
    var data = {
        label:'edu',
        schoolid:schoolid,
        degree:degree,
        major:major,
        graduationYear:graduationYear
    };

    // 发送POST请求到后端
    fetch('', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken // 根据你的页面中实际的CSRF Token变量名填写
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // 解析JSON响应
        return response.json();
    })
    .then(data => {
        // 处理后端返回的JSON数据
        if (data.hasOwnProperty('error')) {
            // 如果后端返回了错误消息，说明保存失败
            alert('保存简历失败: ' + data.error);
        } else {
            // 否则，保存成功
            alert('简历保存成功！');
        }
    })
    .catch(error => {
        console.error('There was a problem with your fetch operation:', error);
        // 这里可以根据实际情况处理错误
    });
}
function cancelAddEducation() {
    // 清空输入框
    document.getElementById('school-input').value = '';
    document.getElementById('degree-select').value = '本科';
    document.getElementById('major-input').value = '';
    document.getElementById('graduation-year-input').value = '';

    // 隐藏对话框
    document.getElementById('education-dialog').style.display = 'none';

}
     function removeEducation(button) {
    var educationItem = button.closest('tr');
    var children = educationItem.children;
    var school=children[1].innerText;
    var degree=children[3].innerText
    console.log(school,degree)
     for(let i=0;i<schoolList.length;i++){
        if(schoolList[i].schoolname.trim()==String(school).trim()){

            var schoolid=schoolList[i].schoolid
        }
    }

    educationItem.remove();

    var data = {
        label:'del',
        schoolid:schoolid,
        degree:degree
    };

    // 发送POST请求到后端
    fetch('', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken // 根据你的页面中实际的CSRF Token变量名填写
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // 解析JSON响应
        return response.json();
    })
    .then(data => {
        // 处理后端返回的JSON数据
        if (data.hasOwnProperty('error')) {
            // 如果后端返回了错误消息，说明保存失败
            alert('保存简历失败: ' + data.error);
        } else {
            // 否则，保存成功
            alert('简历保存成功！');
        }
    })
    .catch(error => {
        console.error('There was a problem with your fetch operation:', error);
        // 这里可以根据实际情况处理错误
    });

}
function result(){
        window.location.href = '/result/';
    }

    function logout() {

        window.location.href = "../";
    }

    </script>
</body>
</html>
